
# **Maven + Java + Kubernetes (Minikube)**

## **Manual / On-Demand CI/CD Pipeline**

> **Deployment will be done using Minikube + kubectl (outside Jenkins pipeline)**
> Jenkins is used for **build + image creation + push**


## **1Ô∏è‚É£ Environment Assumptions**

* OS: **Ubuntu**
* Kubernetes: **Minikube (single-node cluster)**
* Tools:

  * Git
  * Java (JDK)
  * Maven
  * Docker
  * Jenkins
  * Minikube
  * kubectl
  * Docker Hub account

---

## **2Ô∏è‚É£ Install Required Tools**

### Java, Maven, Docker, Jenkins

```bash
sudo apt update
sudo apt install -y openjdk-21-jdk maven docker.io git jenkins
sudo usermod -aG docker $USER
newgrp docker
sudo systemctl start jenkins
sudo systemctl enable jenkins
docker login
```

---

## **3Ô∏è‚É£ Install & Setup Minikube**

```bash
curl -LO https://github.com/kubernetes/minikube/releases/latest/download/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube
rm minikube-linux-amd64
```

Start Kubernetes cluster:

```bash
minikube start
```

---

## **4Ô∏è‚É£ Install kubectl and Verify**

```bash
sudo snap install kubectl --classic
kubectl version --client
kubectl cluster-info
```

---

## **5Ô∏è‚É£ Create Maven Java Application**

```bash
mvn archetype:generate \
-DgroupId=com.example \
-DartifactId=java-app \
-DarchetypeArtifactId=maven-archetype-quickstart \
-DinteractiveMode=false
cd java-app
```
or

mkdir -p java-app/src/main/java/com/example
mkdir -p java-app/src/test/java/com/example
cd java-app

pom.xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>java-app</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>jar</packaging>

  <name>java-app</name>
  <url>http://maven.apache.org</url>

  <properties>
    <maven.compiler.source>8</maven.compiler.source>
    <maven.compiler.target>8</maven.compiler.target>
  </properties>

  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.13.2</version>
      <scope>test</scope>
    </dependency>
  </dependencies>

</project>

nano src/main/java/com/example/App.java
package com.example;

public class App {
    public static void main(String[] args) {
        System.out.println("Hello World!");
    }
}

nano src/test/java/com/example/AppTest.java
package com.example;

import org.junit.Test;
import static org.junit.Assert.assertTrue;

public class AppTest {

    @Test
    public void shouldAnswerWithTrue() {
        assertTrue(true);
    }
}

java -cp target/java-app-1.0-SNAPSHOT.jar com.example.App

mvn clean package

Build JAR:

```bash
mvn clean package
```

---

## **6Ô∏è‚É£ Dockerfile (Java App)**

```dockerfile
FROM openjdk:21-jdk-slim
WORKDIR /app
COPY target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","app.jar"]
```

---

## **7Ô∏è‚É£ Push Code to GitHub**

```bash
git init
git add .
git commit -m "Java Maven app"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/java-app.git
git push -u origin main
```

---

## **8Ô∏è‚É£ Jenkins Pipeline (Manual / On-Demand)**

üëâ **No cron trigger**
üëâ **No Kubernetes deployment inside pipeline**

```groovy
pipeline {
  agent any

  environment {
    IMAGE_NAME = "dockerhubusername/java-app"
    IMAGE_TAG  = "1.0"
  }

  stages {

    stage('Checkout') {
      steps {
        git 'https://github.com/YOUR_USERNAME/java-app.git'
      }
    }

    stage('Build with Maven') {
      steps {
        sh 'mvn clean package'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t $IMAGE_NAME:$IMAGE_TAG .'
      }
    }

    stage('Push to Docker Hub') {
      steps {
        sh 'docker push $IMAGE_NAME:$IMAGE_TAG'
      }
    }
  }
}
```

Trigger this pipeline **manually** in Jenkins.

---

## **9Ô∏è‚É£ Deploy Docker Hub Image on Kubernetes (Minikube)**

### Configure Docker environment

```bash
eval $(minikube docker-env)
```

### Create Kubernetes deployment

```bash
kubectl create deployment java-app \
--image=dockerhubusername/java-app:1.0
```

### Expose the application

```bash
kubectl expose deployment java-app \
--type=NodePort \
--port=8080
```

### Access the application

```bash
minikube service java-app
```

---

## **üîü Verify & Cleanup**

```bash
kubectl get deployments
kubectl get services
kubectl delete deployment java-app
kubectl delete service java-app
minikube stop
```

---

## **üîç Explanation of Pipeline Stages (Manual)**

| Stage             | Description                       |
| ----------------- | --------------------------------- |
| Checkout          | Pulls Java code from GitHub       |
| Maven Build       | Compiles Java app and creates JAR |
| Docker Build      | Builds Docker image               |
| Push              | Pushes image to Docker Hub        |
| Kubernetes Deploy | Done manually using kubectl       |

---

# **PART B ‚Äî Maven + Java + Kubernetes**

## **Cron-Based Automated Pipeline**

---

## ‚ùå What remains the SAME

* Java application
* Maven build
* Dockerfile
* Docker Hub
* Minikube
* Kubernetes deployment **outside pipeline**

---

## ‚úÖ What CHANGES

### 1Ô∏è‚É£ Add Jenkins Cron Trigger

```groovy
triggers {
  cron('H/5 * * * *')
}
```

---

### 2Ô∏è‚É£ Final Jenkinsfile (Cron-Based)

```groovy
pipeline {
  agent any

  environment {
    IMAGE_NAME = "dockerhubusername/java-app"
    IMAGE_TAG  = "1.0"
  }

  triggers {
    cron('H/5 * * * *')
  }

  stages {

    stage('Checkout') {
      steps {
        git 'https://github.com/YOUR_USERNAME/java-app.git'
      }
    }

    stage('Build with Maven') {
      steps {
        sh 'mvn clean package'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t $IMAGE_NAME:$IMAGE_TAG .'
      }
    }

    stage('Push to Docker Hub') {
      steps {
        sh 'docker push $IMAGE_NAME:$IMAGE_TAG'
      }
    }
  }
}
```

---

## **üîÅ Difference Summary (Exam-Friendly)**

| Manual Pipeline     | Cron-Based Pipeline     |
| ------------------- | ----------------------- |
| Triggered manually  | Triggered automatically |
| On-demand execution | Scheduled execution     |
| Same build stages   | Same build stages       |
| Manual K8s deploy   | Manual K8s deploy       |

---



```
GitHub ‚Üí Jenkins ‚Üí Maven ‚Üí Docker Image ‚Üí Docker Hub ‚Üí Kubernetes (Minikube)
```

> Jenkins automates the build process, Docker containerizes the application, Docker Hub stores images, and Kubernetes manages deployment and service exposure.


