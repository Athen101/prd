Maven + Node + Docker Swarm**
Manual / On-Demand Pipeline**

Environment Assumptions**

* Host OS: **Ubuntu**
* Two Ubuntu machines / VMs:

  * **Manager node**
  * **Worker node**
* Tools:

  * Git
  * Node.js + npm
  * Maven
  * Docker
  * Jenkins
  * Docker Swarm

---

## **2Ô∏è‚É£ Install Required Tools (On BOTH nodes)**

```bash
sudo apt update
sudo apt install -y git nodejs npm maven docker.io
sudo usermod -aG docker $USER
newgrp docker
```

### Jenkins (ONLY on Manager node)

```bash
sudo apt install -y jenkins
sudo systemctl start jenkins
sudo systemctl enable jenkins
```

Login to Docker Hub (manager node):

```bash
docker login
```

---

## **3Ô∏è‚É£ Create Node Application (WITHOUT npx)**

```bash
mkdir node-app
cd node-app
npm init -y
npm install express
```

### `index.js`

```js
const express = require('express');
const app = express();

app.get('/', (req, res) => {
  res.send('Node app running on Docker Swarm');
});

app.listen(3000, () => {
  console.log('Server running on port 3000');
});
```

### Update `package.json`

```json
"scripts": {
  "start": "node index.js"
}
```

---

## **4Ô∏è‚É£ Add Maven (Lab Requirement)**

Create `pom.xml`
(Maven is used to **trigger Node dependency installation**)

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>node-app</artifactId>
  <version>1.0</version>

  <build>
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>exec-maven-plugin</artifactId>
        <version>3.1.0</version>
        <configuration>
          <executable>npm</executable>
          <arguments>
            <argument>install</argument>
          </arguments>
        </configuration>
      </plugin>
    </plugins>
  </build>
</project>
 Dockerfile (Node App)**

FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm","start"]

Push Code to GitHub**

git init
git add .
git commit -m "Node app with Maven and Docker"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/node-app.git
git push -u origin main

Docker Swarm Setup (Manager + Worker)**
On Manager Node

docker swarm init --advertise-addr <MANAGER_IP>

You will get a join command like:

docker swarm join --token SWMTKN-xxx <MANAGER_IP>:2377
On Worker Node

docker swarm join --token SWMTKN-xxx <MANAGER_IP>:2377


### üîπ Verify on Manager
docker node ls


You should see **manager + worker**.

Jenkins Pipeline (Manual / On-Demand)**

pipeline {
  agent any

  environment {
    IMAGE_NAME = "dockerhubusername/node-app"
    IMAGE_TAG  = "1.0"
  }

  stages {

    stage('Checkout') {
      steps {
        git 'https://github.com/YOUR_USERNAME/node-app.git'
      }
    }

    stage('Build with Maven') {
      steps {
        sh 'mvn clean install'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t $IMAGE_NAME:$IMAGE_TAG .'
      }
    }

    stage('Push to Docker Hub') {
      steps {
        sh 'docker push $IMAGE_NAME:$IMAGE_TAG'
      }
    }
  }
}


Run this **manually** in Jenkins.

Docker Swarm Deployment (OUTSIDE PIPELINE)**
 Run **ONLY on Manager node terminal**

docker service create \
--name node-app \
--replicas 2 \
-p 3000:3000 \
dockerhubusername/node-app:1.0


Check:

docker service ls
docker service ps node-app

Swarm automatically distributes containers across **manager and worker**.

## **üîü Explanation of Pipeline Stages (Manual)**

| Stage        | Explanation                      |
| ------------ | -------------------------------- |
| Checkout     | Pulls Node app code from GitHub  |
| Maven Build  | Runs npm install using Maven     |
| Docker Build | Creates Docker image             |
| Push         | Pushes image to Docker Hub       |
| Deployment   | Done manually using Docker Swarm |

# **PART B ‚Äî Cron-Based Automated Pipeline**
(What changes from Part A)


* Node app
* Maven usage
* Dockerfile
* Docker Swarm (manager + worker)
* Deployment **outside pipeline**


### 1Ô∏è‚É£ Add cron trigger in Jenkinsfile

triggers {
  cron('H/5 * * * *')
}

### 2Ô∏è‚É£ Final Jenkinsfile (Cron-Based)

```groovy
pipeline {
  agent any

  environment {
    IMAGE_NAME = "dockerhubusername/node-app"
    IMAGE_TAG  = "1.0"
  }

  triggers {
    cron('H/5 * * * *')
  }

  stages {

    stage('Checkout') {
      steps {
        git 'https://github.com/YOUR_USERNAME/node-app.git'
      }
    }

    stage('Build with Maven') {
      steps {
        sh 'mvn clean install'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t $IMAGE_NAME:$IMAGE_TAG .'
      }
    }

    stage('Push to Docker Hub') {
      steps {
        sh 'docker push $IMAGE_NAME:$IMAGE_TAG'
      }
    }
  }
}

## **üîÅ Difference Summary (Exam-Friendly)**

| Manual Pipeline     | Cron-Based Pipeline     |
| ------------------- | ----------------------- |
| Triggered manually  | Triggered automatically |
| User clicks Build   | Runs on schedule        |
| Same build stages   | Same build stages       |
| Manual Swarm deploy | Manual Swarm deploy     |

---

## 

```
GitHub ‚Üí Jenkins ‚Üí Maven ‚Üí Docker Image ‚Üí Docker Hub ‚Üí Docker Swarm (Manager + Worker)
```

> Jenkins handles CI, Docker Swarm handles container orchestration, and deployment is performed manually from the manager node.

